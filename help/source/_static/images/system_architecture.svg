<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 720" font-family="Arial, sans-serif">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
    <filter id="shadow" x="-2%" y="-2%" width="104%" height="104%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.15"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#1a1a2e">OMRAT System Architecture</text>

  <!-- QGIS Layer -->
  <rect x="20" y="50" width="860" height="80" rx="10" fill="#e8f4fd" stroke="#2196F3" stroke-width="2" filter="url(#shadow)"/>
  <text x="450" y="75" text-anchor="middle" font-size="16" font-weight="bold" fill="#1565C0">QGIS Application</text>
  <text x="450" y="100" text-anchor="middle" font-size="12" fill="#1976D2">Map Canvas | Layer Management | Coordinate Transformations | Task Manager</text>

  <!-- Plugin Core -->
  <rect x="250" y="155" width="400" height="55" rx="8" fill="#fff3e0" stroke="#FF9800" stroke-width="2" filter="url(#shadow)"/>
  <text x="450" y="178" text-anchor="middle" font-size="14" font-weight="bold" fill="#E65100">omrat.py</text>
  <text x="450" y="195" text-anchor="middle" font-size="11" fill="#EF6C00">Plugin Orchestrator &amp; Signal Manager</text>
  <line x1="450" y1="130" x2="450" y2="155" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- UI Layer -->
  <rect x="20" y="235" width="200" height="170" rx="8" fill="#f3e5f5" stroke="#9C27B0" stroke-width="2" filter="url(#shadow)"/>
  <text x="120" y="258" text-anchor="middle" font-size="14" font-weight="bold" fill="#6A1B9A">UI Widgets</text>
  <text x="120" y="280" text-anchor="middle" font-size="10" fill="#7B1FA2">omrat_widget.py</text>
  <text x="120" y="298" text-anchor="middle" font-size="10" fill="#7B1FA2">traffic_data_widget.py</text>
  <text x="120" y="316" text-anchor="middle" font-size="10" fill="#7B1FA2">drift_settings_widget.py</text>
  <text x="120" y="334" text-anchor="middle" font-size="10" fill="#7B1FA2">result_widget.py</text>
  <text x="120" y="352" text-anchor="middle" font-size="10" fill="#7B1FA2">ship_categories_widget.py</text>
  <text x="120" y="370" text-anchor="middle" font-size="10" fill="#7B1FA2">causation_factor_widget.py</text>
  <text x="120" y="388" text-anchor="middle" font-size="10" fill="#7B1FA2">ais_connection_widget.py</text>
  <line x1="250" y1="182" x2="220" y2="235" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Data Management Layer -->
  <rect x="245" y="235" width="210" height="170" rx="8" fill="#e8f5e9" stroke="#4CAF50" stroke-width="2" filter="url(#shadow)"/>
  <text x="350" y="258" text-anchor="middle" font-size="14" font-weight="bold" fill="#2E7D32">Data Management</text>
  <text x="350" y="278" text-anchor="middle" font-size="10" fill="#388E3C">omrat_utils/</text>
  <text x="350" y="296" text-anchor="middle" font-size="10" fill="#388E3C">handle_traffic.py</text>
  <text x="350" y="314" text-anchor="middle" font-size="10" fill="#388E3C">handle_object.py</text>
  <text x="350" y="332" text-anchor="middle" font-size="10" fill="#388E3C">handle_distributions.py</text>
  <text x="350" y="350" text-anchor="middle" font-size="10" fill="#388E3C">handle_settings.py</text>
  <text x="350" y="368" text-anchor="middle" font-size="10" fill="#388E3C">handle_ais.py</text>
  <text x="350" y="386" text-anchor="middle" font-size="10" fill="#388E3C">gather_data.py | storage.py</text>
  <line x1="400" y1="210" x2="370" y2="235" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Geometry Layer -->
  <rect x="480" y="235" width="200" height="170" rx="8" fill="#fce4ec" stroke="#E91E63" stroke-width="2" filter="url(#shadow)"/>
  <text x="580" y="258" text-anchor="middle" font-size="14" font-weight="bold" fill="#AD1457">Geometries</text>
  <text x="580" y="278" text-anchor="middle" font-size="10" fill="#C2185B">geometries/</text>
  <text x="580" y="296" text-anchor="middle" font-size="10" fill="#C2185B">handle_qgis_iface.py</text>
  <text x="580" y="314" text-anchor="middle" font-size="10" fill="#C2185B">route.py</text>
  <text x="580" y="332" text-anchor="middle" font-size="10" fill="#C2185B">drift/generator.py</text>
  <text x="580" y="350" text-anchor="middle" font-size="10" fill="#C2185B">drift/corridor.py</text>
  <text x="580" y="368" text-anchor="middle" font-size="10" fill="#C2185B">drift/shadow.py | clipping.py</text>
  <text x="580" y="386" text-anchor="middle" font-size="10" fill="#C2185B">result_layers.py</text>
  <line x1="550" y1="210" x2="570" y2="235" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- External Data -->
  <rect x="705" y="235" width="170" height="170" rx="8" fill="#e0f2f1" stroke="#009688" stroke-width="2" filter="url(#shadow)"/>
  <text x="790" y="258" text-anchor="middle" font-size="14" font-weight="bold" fill="#00695C">External Data</text>
  <text x="790" y="285" text-anchor="middle" font-size="10" fill="#00796B">PostgreSQL/PostGIS</text>
  <text x="790" y="303" text-anchor="middle" font-size="10" fill="#00796B">(AIS Data)</text>
  <text x="790" y="330" text-anchor="middle" font-size="10" fill="#00796B">OpenTopography API</text>
  <text x="790" y="348" text-anchor="middle" font-size="10" fill="#00796B">(GEBCO Bathymetry)</text>
  <text x="790" y="375" text-anchor="middle" font-size="10" fill="#00796B">IWRAP XML Files</text>
  <text x="790" y="393" text-anchor="middle" font-size="10" fill="#00796B">(Import / Export)</text>
  <line x1="650" y1="182" x2="705" y2="270" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Computation Engine -->
  <rect x="150" y="435" width="600" height="80" rx="8" fill="#fff8e1" stroke="#FFC107" stroke-width="2" filter="url(#shadow)"/>
  <text x="450" y="460" text-anchor="middle" font-size="14" font-weight="bold" fill="#F57F17">Computation Engine (compute/)</text>
  <text x="250" y="495" text-anchor="middle" font-size="11" fill="#F9A825">basic_equations.py</text>
  <text x="450" y="495" text-anchor="middle" font-size="11" fill="#F9A825">run_calculations.py</text>
  <text x="650" y="495" text-anchor="middle" font-size="11" fill="#F9A825">calculation_task.py</text>
  <line x1="350" y1="405" x2="350" y2="435" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="580" y1="405" x2="550" y2="435" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Calculation Types -->
  <rect x="50" y="545" width="220" height="60" rx="8" fill="#e3f2fd" stroke="#1976D2" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="160" y="570" text-anchor="middle" font-size="12" font-weight="bold" fill="#0D47A1">Drifting Risk</text>
  <text x="160" y="590" text-anchor="middle" font-size="10" fill="#1565C0">Grounding | Allision | Anchoring</text>

  <rect x="290" y="545" width="220" height="60" rx="8" fill="#e8eaf6" stroke="#3F51B5" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="400" y="570" text-anchor="middle" font-size="12" font-weight="bold" fill="#1A237E">Powered Risk</text>
  <text x="400" y="590" text-anchor="middle" font-size="10" fill="#283593">Cat I (Direct) | Cat II (Bend)</text>

  <rect x="530" y="545" width="250" height="60" rx="8" fill="#ede7f6" stroke="#673AB7" stroke-width="1.5" filter="url(#shadow)"/>
  <text x="655" y="570" text-anchor="middle" font-size="12" font-weight="bold" fill="#311B92">Ship-Ship Collisions</text>
  <text x="655" y="590" text-anchor="middle" font-size="10" fill="#4527A0">Head-On | Overtaking | Crossing | Bend</text>

  <line x1="300" y1="515" x2="160" y2="545" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="450" y1="515" x2="400" y2="545" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="550" y1="515" x2="655" y2="545" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Output Layer -->
  <rect x="150" y="635" width="600" height="55" rx="8" fill="#efebe9" stroke="#795548" stroke-width="2" filter="url(#shadow)"/>
  <text x="450" y="658" text-anchor="middle" font-size="14" font-weight="bold" fill="#4E342E">Output &amp; Visualization</text>
  <text x="450" y="678" text-anchor="middle" font-size="11" fill="#5D4037">QGIS Result Layers | Graduated Symbology | Reports | .omrat Project Files</text>
  <line x1="160" y1="605" x2="300" y2="635" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="400" y1="605" x2="400" y2="635" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="655" y1="605" x2="600" y2="635" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
</svg>
